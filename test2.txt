This is part 2 with master changes